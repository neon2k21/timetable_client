# Работа с сервером

#   Схема базы данных
![Схема базы данных](/image.png)


# Документация UserController

Эта документация описывает класс `UserController`, который отвечает за операции, связанные с пользователями, такие как создание, получение, удаление пользователей и установка токенов. Класс взаимодействует с базой данных с помощью SQL-запросов и возвращает ответы в формате JSON.

## Предварительные требования
Перед использованием `UserController`, убедитесь, что:
1. База данных настроена и доступна через модуль `db` (`require('../config')`).
2. Необходимые таблицы базы данных (например, `users`) созданы.

---

## Методы

### 1. **`createUser(req, res)`**
   Создает нового пользователя в базе данных.

   **Параметры запроса (Body)**:
   - `login` (строка): Логин пользователя.
   - `pass` (строка): Пароль пользователя.

   **SQL-запрос**:
   ```sql
   INSERT INTO users (login, pass, token) VALUES (?, ?, "");
   ```

   **Ответ**:
   - Возвращает данные вставленного пользователя в случае успеха.
   - Возвращает ошибку, если операция завершилась неудачей.

   **Пример**:
   ```json
   {
     "login": "example_user",
     "pass": "password123"
   }
   ```

---

### 2. **`getUser(req, res)`**
   Получает данные пользователя из базы данных на основе предоставленных логина и пароля.

   **Параметры запроса (Body)**:
   - `login` (строка): Логин пользователя.
   - `password` (строка): Пароль пользователя.

   **SQL-запрос**:
   ```sql
   SELECT * FROM users WHERE (login=? AND pass=?);
   ```

   **Ответ**:
   - Возвращает данные пользователя, если учетные данные совпадают.
   - Возвращает сообщение `"Данные не совпадают! Проверьте и повторите попытку"`, если учетные данные не совпадают.
   - Возвращает ошибку, если операция завершилась неудачей.

   **Пример**:
   ```json
   {
     "login": "example_user",
     "password": "password123"
   }
   ```

---

### 3. **`deleteUser(req, res)`**
   Удаляет пользователя из базы данных на основе предоставленного ID пользователя.

   **Параметры запроса (Body)**:
   - `id` (целое число): ID пользователя для удаления.

   **SQL-запрос**:
   ```sql
   DELETE FROM users WHERE id = ?;
   ```

   **Ответ**:
   - Возвращает результат операции удаления.
   - Возвращает ошибку, если операция завершилась неудачей.

   **Пример**:
   ```json
   {
     "id": 1
   }
   ```

---

### 4. **`setUserToken(req, res)`**
   Обновляет токен для конкретного пользователя на основе его ID.

   **Параметры запроса (Body)**:
   - `user` (целое число): ID пользователя, для которого обновляется токен.
   - `token` (строка): Новый токен для пользователя.

   **SQL-запрос**:
   ```sql
   UPDATE users SET token = ? WHERE id = ?;
   ```

   **Ответ**:
   - Возвращает результат операции обновления.
   - Возвращает ошибку, если операция завершилась неудачей.

   **Пример**:
   ```json
   {
     "user": 1,
     "token": "new-token-value"
   }
   ```

---

## Пример использования

Вот как можно использовать `UserController` в обработчике маршрутов:

```javascript
const Router = require('express')
const router = new Router()
const userController = require('../controller/user.controller')

//Создание пользователя
router.post('/createUser', userController.createUser)

//Получение пользователя
router.post('/getuser', userController.getUser)

//Удаление пользователя
router.delete('/user', userController.deleteUser)

//Установка токена телефона к юзеру
router.put('/setusertoken', userController.setUserToken)


module.exports = router
```

---


# Документация CategoryController

Эта документация описывает класс `CategoryController`, который отвечает за операции с категориями, такие как создание, изменение и удаление категорий. Класс взаимодействует с базой данных с помощью SQL-запросов и возвращает ответы в формате JSON.

## Предварительные требования
Перед использованием `CategoryController`, убедитесь, что:
1. База данных настроена и доступна через модуль `db` (`require('../config')`).
2. Необходимые таблицы базы данных (например, `category`) созданы.

---

## Методы

### 1. **`createCategory(req, res)`**
   Создает новую категорию в базе данных.

   **Параметры запроса (Body)**:
   - `name` (строка): Название категории.

   **SQL-запрос**:
   ```sql
   INSERT INTO category (name) VALUES (?);
   ```

   **Ответ**:
   - Возвращает данные вставленной категории в случае успеха.
   - Возвращает ошибку, если операция завершилась неудачей.

   **Пример**:
   ```json
   {
     "name": "Новая категория"
   }
   ```

---

### 2. **`updateCategory(req, res)`**
   Изменяет название категории на основе предоставленного ID.

   **Параметры запроса (Body)**:
   - `id` (целое число): ID категории для обновления.
   - `name` (строка): Новое название категории.

   **SQL-запрос**:
   ```sql
   UPDATE category SET name=? WHERE id=?;
   ```

   **Ответ**:
   - Возвращает результат операции обновления.
   - Возвращает ошибку, если операция завершилась неудачей.

   **Пример**:
   ```json
   {
     "id": 1,
     "name": "Обновленная категория"
   }
   ```

---

### 3. **`deleteCategory(req, res)`**
   Удаляет категорию из базы данных на основе предоставленного ID.

   **Параметры запроса (Body)**:
   - `id` (целое число): ID категории для удаления.

   **SQL-запрос**:
   ```sql
   DELETE FROM category WHERE id=?;
   ```

   **Ответ**:
   - Возвращает результат операции удаления.
   - Возвращает ошибку, если операция завершилась неудачей.

   **Пример**:
   ```json
   {
     "id": 1
   }
   ```

---

## Пример использования

Вот как можно использовать `CategoryController` в обработчике маршрутов:

```javascript
const Router = require('express')
const router = new Router()
const categoryController = require('../controller/category.controller')

// создание своей категории
router.post('/createCategory', categoryController.createCategory)

// изменение своей задания
router.put('/updateCategory', categoryController.updateCategory)

// удаление своей категории
router.post('/deleteCategory',categoryController.deleteCategory)



module.exports = router
```

---



# Документация TasksController

Класс `TasksController` предоставляет API для создания, обновления, удаления заданий, получения заданий пользователя, а также для построения графиков и диаграмм, показывающих количество завершенных и незавершенных заданий за день, неделю и месяц. Все запросы взаимодействуют с базой данных через SQL-запросы и возвращают данные в формате JSON.

## Методы

### 1. **`createTask(req, res)`**
   Создает новое задание для пользователя.

   **Параметры запроса (Body)**:
   - `user_id` (целое число): ID пользователя.
   - `name` (строка): Название задания.
   - `description` (строка): Описание задания.
   - `deadline` (строка): Дата и время дедлайна задания.
   - `category_id` (целое число): ID категории задания.

   **SQL-запрос**:
   ```sql
   INSERT INTO tasks (user_id, name, description, date_of_creation, deadline, completed, category_id) 
   VALUES (?, ?, ?, ?, ?, 0, ?);
   ```

   **Ответ**:
   - Возвращает данные о созданном задании или ошибку.

---

### 2. **`updateTaskStage(req, res)`**
   Обновляет состояние выполнения задания (завершено или не завершено).

   **Параметры запроса (Body)**:
   - `task_id` (целое число): ID задания.
   - `completed` (целое число): Статус задания (1 — завершено, 0 — не завершено).

   **SQL-запрос**:
   ```sql
   UPDATE tasks SET completed=? WHERE id=?;
   ```

   **Ответ**:
   - Возвращает результат операции обновления или ошибку.

---

### 3. **`getAllUserTasksByFilter(req, res)`**
   Получает все задания пользователя по фильтру (по категории).

   **Параметры запроса (Body)**:
   - `user_id` (целое число): ID пользователя.
   - `category` (строка): Название категории для фильтрации.

   **SQL-запрос**:
   ```sql
   SELECT * FROM tasks WHERE user_id = ? AND category = ?;
   ```

   **Ответ**:
   - Возвращает список заданий пользователя, соответствующих фильтру, или ошибку.

---

### 4. **`getAllUserTasks(req, res)`**
   Получает все задания пользователя.

   **Параметры запроса (Body)**:
   - `user_id` (целое число): ID пользователя.

   **SQL-запрос**:
   ```sql
   SELECT * FROM tasks WHERE user_id = ?;
   ```

   **Ответ**:
   - Возвращает список всех заданий пользователя или ошибку.

---

### 5. **`getCurrentTask(req, res)`**
   Получает конкретное задание по `task_id`.

   **Параметры запроса (Body)**:
   - `task_id` (целое число): ID задания.

   **SQL-запрос**:
   ```sql
   SELECT * FROM tasks WHERE id = ?;
   ```

   **Ответ**:
   - Возвращает данные о задании с указанным `task_id` или ошибку.

---

### 6. **`deleteTask(req, res)`**
   Удаляет задание по `task_id`.

   **Параметры запроса (Body)**:
   - `task_id` (целое число): ID задания.

   **SQL-запрос**:
   ```sql
   DELETE FROM tasks WHERE id = ?;
   ```

   **Ответ**:
   - Возвращает результат удаления задания или ошибку.

---

### 7. **`createGraphByFilterForWeek(req, res)`**
   Создает график для завершенных и незавершенных заданий пользователя за последнюю неделю.

   **Параметры запроса (Body)**:
   - `user_id` (целое число): ID пользователя.

   **SQL-запрос**:
   ```sql
   SELECT completed, COUNT(*) AS task_count
   FROM tasks
   WHERE date_of_creation BETWEEN date('now', '-7 days') AND date('now') AND user_id=?
   GROUP BY completed;
   ```

   **Ответ**:
   - Возвращает JSON с количеством завершенных и незавершенных заданий за неделю:
     ```json
     {
       "completed": <количество завершенных>,
       "uncompleted": <количество незавершенных>
     }
     ```

---

### 8. **`createGraphByFilterForDay(req, res)`**
   Создает график для завершенных и незавершенных заданий пользователя за текущий день.

   **Параметры запроса (Body)**:
   - `user_id` (целое число): ID пользователя.

   **SQL-запрос**:
   ```sql
   SELECT completed, COUNT(*) AS task_count
   FROM tasks
   WHERE date_of_creation = date('now') AND user_id=?
   GROUP BY completed;
   ```

   **Ответ**:
   - Возвращает JSON с количеством завершенных и незавершенных заданий за день:
     ```json
     {
       "completed": <количество завершенных>,
       "uncompleted": <количество незавершенных>
     }
     ```

---

### 9. **`createGraphByFilterForMonth(req, res)`**
   Создает график для завершенных и незавершенных заданий пользователя за текущий месяц.

   **Параметры запроса (Body)**:
   - `user_id` (целое число): ID пользователя.

   **SQL-запрос**:
   ```sql
   SELECT completed, COUNT(*) AS task_count
   FROM tasks
   WHERE date_of_creation BETWEEN date('now', 'start of month') AND date('now') AND user_id=?
   GROUP BY completed;
   ```

   **Ответ**:
   - Возвращает JSON с количеством завершенных и незавершенных заданий за месяц:
     ```json
     {
       "completed": <количество завершенных>,
       "uncompleted": <количество незавершенных>
     }
     ```

---

## Обработка ошибок
- Все методы обрабатывают ошибки, возвращая JSON-ответ с сообщением об ошибке, если операции с базой данных завершились неудачей.
- Пример ответа с ошибкой:
   ```json
   {
     "error": "Сообщение об ошибке"
   }
   ```

---

